<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SR‑2555 Trainer</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f4f6f8;
    margin: 0;
    padding: 20px;
}

.container {
    max-width: 900px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

h1 {
    margin-top: 0;
}

.controls {
    margin-bottom: 15px;
}

button {
    padding: 6px 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background: #f0f0f0;
    cursor: pointer;
}

button:hover {
    background: #e0e0e0;
}

.phrase {
    padding: 6px 0;
}

.id {
    display: inline-block;
    width: 40px;
    color: #888;
}

.translation {
    color: #0066cc;
    margin-left: 40px;
    display: none;
}

.examples {
    color: #7a3db8;
    margin-left: 40px;
    display: none;
}

.progress {
    margin-top: 10px;
    color: #555;
}
</style>

</head>
<body>

<div class="container">

<h1>SR‑2555 Trainer</h1>

<div class="controls">
<input type="file" id="csvFile">
<button onclick="loadCSV()">Load CSV</button>
</div>

<div class="controls">
Day:
<input type="number" id="dayInput" value="1" min="1">
<button onclick="loadDay()">Load Day</button>
<button onclick="nextDay()">Next Day</button>
</div>

<div class="progress" id="progress"></div>

<div id="phrases"></div>

</div>

<script>

let phrases = [];
let intervals = [1,3,7,14,30,90,180];
let newPerDay = 7;

function loadCSV() {

    const file = document.getElementById('csvFile').files[0];
    if (!file) return;

    const reader = new FileReader();

    reader.onload = function(e) {

        const text = e.target.result;
        const rows = text.split('\n').slice(1);

        phrases = rows.map(row => {

            const cols = row.split(',');

            return {
                id: Number(cols[0]),
                en: cols[1],
                sk: cols[2] || "",
                ex1: cols[3] || "",
                ex2: cols[4] || "",
                ex3: cols[5] || ""
            };

        });

        restoreLastDay();

    };

    reader.readAsText(file);
}

function restoreLastDay() {

    const lastDay = localStorage.getItem("sr_last_day");

    if (lastDay) {
        document.getElementById("dayInput").value = lastDay;
        loadDay();
    }

}

function saveLastDay(day) {
    localStorage.setItem("sr_last_day", day);
}

function loadDay() {

    const day = Number(document.getElementById("dayInput").value);
    saveLastDay(day);

    const review = [];
    const startNew = (day - 1) * newPerDay;
    const newOnes = phrases.slice(startNew, startNew + newPerDay);

    for (let i = 0; i < phrases.length; i++) {

        for (let int of intervals) {

            if (day - int > 0) {

                const learnedDay = Math.ceil((i+1)/newPerDay);

                if (learnedDay === day - int) {
                    review.push(phrases[i]);
                }

            }

        }

    }

    render(review, newOnes);

    document.getElementById("progress").innerText =
        "Day " + day +
        " • Review: " + review.length +
        " • New: " + newOnes.length +
        " • Total phrases: " + phrases.length;

}

function nextDay() {

    const input = document.getElementById("dayInput");
    input.value = Number(input.value) + 1;
    loadDay();

}

function render(review, newOnes) {

    const container = document.getElementById("phrases");
    container.innerHTML = "";

    review.forEach(p => container.appendChild(createPhrase(p)));

    container.appendChild(document.createElement("br"));

    newOnes.forEach(p => container.appendChild(createPhrase(p)));

}

function createPhrase(p) {

    const div = document.createElement("div");
    div.className = "phrase";

    const id = document.createElement("span");
    id.className = "id";
    id.innerText = p.id;

    const text = document.createElement("span");
    text.innerText = p.en;

    const btnSK = document.createElement("button");
    btnSK.innerText = "SK";
    btnSK.onclick = () => toggle(sk);

    const btnEX = document.createElement("button");
    btnEX.innerText = "Examples";
    btnEX.onclick = () => toggle(ex);

    const sk = document.createElement("div");
    sk.className = "translation";
    sk.innerText = p.sk;

    const ex = document.createElement("div");
    ex.className = "examples";
    ex.innerText = [p.ex1,p.ex2,p.ex3].filter(Boolean).join("\n");

    div.append(id, text, btnSK, btnEX, sk, ex);

    return div;
}

function toggle(el) {
    el.style.display = el.style.display === "block" ? "none" : "block";
}

</script>

</body>
</html>
